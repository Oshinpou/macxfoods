<!-- adminorders.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Orders - MACX</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
</head>
<body>
  <div class="container">
    <h1>All Orders (Admin View)</h1>
    <div id="allOrdersList"></div>
  </div>

  <script>
    const gun = Gun();
    const adminOrders = gun.get("admin_orders");
    const allOrdersList = document.getElementById("allOrdersList");

    adminOrders.map().once((order, id) => {
      if (!order || !order.items) return;

      const div = document.createElement("div");
      const items = order.items.map(item => `<li>${item.productName} x ${item.quantity} - ₹${item.price}</li>`).join('');

      div.innerHTML = `
        <h3>Order ID: ${id}</h3>
        <p><strong>User:</strong> ${order.username}</p>
        <p><strong>Status:</strong> ${order.status || 'Pending'}</p>
        <p><strong>Payment ID:</strong> ${order.razorpayPaymentId || 'N/A'}</p>
        <p><strong>Total Paid:</strong> ₹${order.total || 0}</p>
        <p><strong>Name:</strong> ${order.shipping?.name || ''}</p>
        <p><strong>Phone:</strong> ${order.shipping?.phone || ''}</p>
        <p><strong>Address:</strong> ${order.shipping?.address || ''}, ${order.shipping?.country || ''} - ${order.shipping?.pincode || ''}</p>
        <ul>${items}</ul>
        <button onclick="updateStatus('${id}', 'Completed')">Mark as Completed</button>
        <button onclick="deleteOrder('${id}')">Delete (Garbage Clean)</button>
        <hr>
      `;
      allOrdersList.appendChild(div);
    });

    function updateStatus(id, newStatus) {
      adminOrders.get(id).get("status").put(newStatus);
      alert("Status updated to " + newStatus);
      location.reload();
    }

    function deleteOrder(id) {
      const sure = confirm("Are you sure you want to delete this order?");
      if (!sure) return;
      adminOrders.get(id).put(null);
      alert("Order deleted.");
      location.reload();
    }
  </script>
</body>
</html>
