<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Orders - MACX</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
</head>
<body>
  <div class="container">
    <h1>All Orders (Admin)</h1>
    <div id="allOrders"></div>
  </div>

  <script>
    const gun = Gun();
    const ordersRoot = gun.get("macx_orders");
    const allOrders = document.getElementById("allOrders");

    ordersRoot.map().once((userOrders, username) => {
      if (!userOrders || typeof userOrders !== 'object') return;

      gun.get("macx_orders").get(username).map().once((order, orderId) => {
        if (!order || !order.items) return;

        const div = document.createElement("div");
        const itemsList = order.items.map ? order.items.map(item => `<li>${item.productName} x ${item.quantity} - ₹${item.price}</li>`).join('') : '';

        div.innerHTML = `
          <h3>User: ${username} | Order ID: ${orderId}</h3>
          <p>Status: ${order.status || 'N/A'} | Payment: ${order.paymentStatus || 'N/A'} - ₹${order.grandTotal || 0}</p>
          <p>Shipping: ${order.name || ''}, ${order.phone || ''}, ${order.email || ''}, ${order.address || ''}, ${order.country || ''}, ${order.pincode || ''}</p>
          <ul>${itemsList}</ul>
          <button onclick="updateStatus('${username}', '${orderId}', 'Delivered')">Mark Delivered</button>
          <button onclick="deleteOrder('${username}', '${orderId}')">Delete Order</button>
          <hr>
        `;
        allOrders.appendChild(div);
      });
    });

    function updateStatus(username, orderId, status) {
      gun.get("macx_orders").get(username).get(orderId).get("status").put(status);
      alert("Status updated.");
      window.location.reload();
    }

    function deleteOrder(username, orderId) {
      if (confirm("Delete this order permanently?")) {
        gun.get("macx_orders").get(username).get(orderId).put(null);
        alert("Order deleted.");
        window.location.reload();
      }
    }
  </script>
</body>
</html>
